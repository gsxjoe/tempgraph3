<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sensor Data Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            max-width: 800px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1>Sensor Readings Over Time</h1>
    <div class="chart-container">
        <canvas id="myChart"></canvas>
    </div>


    <script>
        // Function to fetch CSV data and create the chart
        async function createChart() {
            try {
                // Use the browser's fetch API to get the CSV file
                const response = await fetch('/static/sensor_readings.csv');
                const csvData = await response.text();

                // Parse CSV data
                const rows = csvData.split('\n').slice(1); // Skip header row
                const timestamps = [];
                const Grill = [];
                const Meat = [];

                rows.forEach(row => {
                    const columns = row.split(',');
                    if (columns.length === 3) {
                        timestamp.push(columns[0]);
                        Grill.push(parseFloat(columns[1]));
                        Meat.push(parseFloat(columns[2]));
                    }
                });

                // Get the canvas element
                const ctx = document.getElementById('myChart').getContext('2d');

                // Create the chart
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timestamp,
                        datasets: [
                            {
                                label: 'Grill',
                                data: Grill,
                                borderColor: 'rgb(75, 192, 192)',
                                tension: 0.1,
                                fill: false
                            },
                            {
                                label: 'Meat',
                                data: Meat,
                                borderColor: 'rgb(255, 99, 132)',
                                tension: 0.1,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    parser: 'MM-DDTHH:mm',
                                    tooltipFormat: 'MM/dd/yyyy HH:mm',
                                    unit: 'hour'
                                },
                                title: {
                                    display: true,
                                    text: 'Timestamp'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Temperature'
                                }
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('Error fetching or creating chart:', error);
            }
        }
        createChart();
    </script>
</body>
</html>
